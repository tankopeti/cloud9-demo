@* /Pages/DocManagement/Doc/_Modals.cshtml
   Dokumentum modals: CREATE + VIEW + EDIT
   ‚úÖ Model-f√ºggetlen partial (NINCS @model), hogy ne dobjon —Ç–∏–øushib√°t az IndexModel miatt.
   ‚úÖ Minden list√°t (DocumentType, Partner, Site, Status) JS t√∂lthet.
*@

<!-- =========================
     CREATE DOCUMENT MODAL
========================= -->
<div class="modal fade" id="createDocumentModal" tabindex="-1" aria-labelledby="createDocumentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="createDocumentModalLabel">√öj dokumentum</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bez√°r√°s"></button>
            </div>

            <div class="modal-body">
                <form id="createDocumentForm" class="needs-validation" novalidate enctype="multipart/form-data">
                    <div class="row g-3">
                        <div class="col-12">
                            <label for="docFileName" class="form-label">F√°jln√©v</label>
                            <input type="text" class="form-control" id="docFileName" name="fileName" required maxlength="255" />
                            <div class="invalid-feedback">A f√°jln√©v megad√°sa k√∂telez≈ë.</div>
                        </div>

                        <div class="col-12">
                            <label for="docFile" class="form-label">F√°jl</label>
                            <input type="file" class="form-control" id="docFile" name="file" required />
                            <div class="invalid-feedback">F√°jl kiv√°laszt√°sa k√∂telez≈ë.</div>
                        </div>

                        <div class="col-md-6">
                            <label for="docDocumentTypeId" class="form-label">Dokumentum t√≠pusa</label>
                            <select class="form-select" id="docDocumentTypeId" name="documentTypeId">
                                <option value="">‚Äî V√°lassz ‚Äî</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="docStatus" class="form-label">St√°tusz</label>
                            <select class="form-select" id="docStatus" name="status" required>
                                <option value="">‚Äî V√°lassz ‚Äî</option>
                            </select>
                            <div class="invalid-feedback">St√°tusz kiv√°laszt√°sa k√∂telez≈ë.</div>
                        </div>

                        <div class="col-md-6">
                            <label for="docPartnerId" class="form-label">Partner</label>
                            <select class="form-select" id="docPartnerId" name="partnerId">
                                <option value="">‚Äî V√°lassz ‚Äî</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="docSiteId" class="form-label">Telephely</label>
                            <select class="form-select" id="docSiteId" name="siteId" disabled>
                                <option value="">‚Äî El≈ëbb v√°lassz partnert ‚Äî</option>
                            </select>
                        </div>

                        <!-- Custom metadata (opcion√°lis) -->
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <label class="form-label mb-0">Egyedi metaadatok (opcion√°lis)</label>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="addDocMetaRowBtn">
                                    + Sor
                                </button>
                            </div>

                        <div class="border rounded p-2 mt-2">
                            <div id="docMetaRows">
                                <div class="row g-2 align-items-center mb-2 doc-meta-row" data-index="0">
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" name="customMetadata[0].key" placeholder="Kulcs" />
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" name="customMetadata[0].value" placeholder="√ârt√©k" />
                                    </div>
                                    <div class="col-md-1 d-grid">
                                        <button type="button" class="btn btn-outline-danger btn-sm" data-action="remove-meta" disabled>&times;</button>
                                    </div>
                                </div>
                            </div>

                            <small class="text-muted">Ha nem kell metaadat, hagyd √ºresen.</small>
                        </div>

                        </div>

                        <div class="col-12 d-none" id="createDocErrorBox">
                            <div class="alert alert-danger mb-0" role="alert" id="createDocErrorText">
                                Hiba t√∂rt√©nt a ment√©s k√∂zben.
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">M√©gse</button>
                <button type="button" class="btn btn-primary" id="saveNewDocumentBtn">Ment√©s</button>
            </div>
        </div>
    </div>
</div>


<!-- =========================
     VIEW DOCUMENT MODAL
     (1 db √∫jrahasznos√≠that√≥ modal, JS t√∂lti be docId alapj√°n)
========================= -->
<div class="modal fade" id="viewDocumentModal" tabindex="-1" aria-labelledby="viewDocumentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="viewDocumentModalLabel">Dokumentum megtekint√©se</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bez√°r√°s"></button>
            </div>

            <div class="modal-body">
                <div class="d-flex justify-content-between align-items-start gap-2">
                    <div>
                        <div class="text-muted small">Dokumentum ID</div>
                        <div class="fw-semibold" id="viewDocId">‚Äî</div>
                    </div>
                    <div class="text-end">
                        <a class="btn btn-outline-primary btn-sm d-none" id="viewDocOpenFileLink" href="#" target="_blank">
                            <i class="bi bi-box-arrow-up-right me-1"></i>Megnyit√°s
                        </a>
                    </div>
                </div>

                <hr class="my-3" />

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="text-muted small">F√°jln√©v</div>
                        <div class="fw-semibold" id="viewDocFileName">‚Äî</div>
                    </div>

                    <div class="col-md-6">
                        <div class="text-muted small">T√≠pus</div>
                        <div class="fw-semibold" id="viewDocType">‚Äî</div>
                    </div>

                    <div class="col-md-6">
                        <div class="text-muted small">Partner</div>
                        <div class="fw-semibold" id="viewDocPartner">‚Äî</div>
                    </div>

                    <div class="col-md-6">
                        <div class="text-muted small">Telephely</div>
                        <div class="fw-semibold" id="viewDocSite">‚Äî</div>
                    </div>

                    <div class="col-md-6">
                        <div class="text-muted small">St√°tusz</div>
                        <div class="fw-semibold" id="viewDocStatus">‚Äî</div>
                    </div>

                    <div class="col-md-6">
                        <div class="text-muted small">Felt√∂lt√©s d√°tuma</div>
                        <div class="fw-semibold" id="viewDocUploadDate">‚Äî</div>
                    </div>

                    <div class="col-md-6">
                        <div class="text-muted small">Felt√∂lt√∂tte</div>
                        <div class="fw-semibold" id="viewDocUploadedBy">‚Äî</div>
                    </div>
                </div>

                <hr class="my-3" />

                <div>
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-2">Metaadatok</h6>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-sm table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>Kulcs</th>
                                    <th>√ârt√©k</th>
                                </tr>
                            </thead>
                            <tbody id="viewDocMetadataTbody">
                                <tr>
                                    <td colspan="2" class="text-muted text-center py-3">Nincs metaadat</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="d-none mt-3" id="viewDocErrorBox">
                    <div class="alert alert-danger mb-0" id="viewDocErrorText">Hiba t√∂rt√©nt.</div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Bez√°r√°s</button>
                <button type="button" class="btn btn-outline-primary" id="openEditDocumentBtn" data-document-id="">
                    Szerkeszt√©s
                </button>
            </div>
        </div>
    </div>
</div>


<!-- =========================
     EDIT DOCUMENT MODAL
     (JS t√∂lti fel docId alapj√°n, ment√©s: PUT)
========================= -->
<div class="modal fade" id="editDocumentModal" tabindex="-1" aria-labelledby="editDocumentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header">
                <h5 class="modal-title" id="editDocumentModalLabel">Dokumentum szerkeszt√©se</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bez√°r√°s"></button>
            </div>

            <div class="modal-body">
                <form id="editDocumentForm" class="needs-validation" novalidate>
                    <input type="hidden" id="editDocId" name="documentId" value="" />

                    <div class="row g-3">
                        <div class="col-12">
                            <label for="editDocFileName" class="form-label">F√°jln√©v</label>
                            <input type="text" class="form-control" id="editDocFileName" name="fileName" required maxlength="255" />
                            <div class="invalid-feedback">A f√°jln√©v megad√°sa k√∂telez≈ë.</div>
                        </div>

                        <div class="col-md-6">
                            <label for="editDocDocumentTypeId" class="form-label">Dokumentum t√≠pusa</label>
                            <select class="form-select" id="editDocDocumentTypeId" name="documentTypeId">
                                <option value="">‚Äî V√°lassz ‚Äî</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="editDocStatus" class="form-label">St√°tusz</label>
                            <select class="form-select" id="editDocStatus" name="status" required>
                                <option value="">‚Äî V√°lassz ‚Äî</option>
                            </select>
                            <div class="invalid-feedback">St√°tusz kiv√°laszt√°sa k√∂telez≈ë.</div>
                        </div>

                        <div class="col-md-6">
                            <label for="editDocPartnerId" class="form-label">Partner</label>
                            <select class="form-select" id="editDocPartnerId" name="partnerId">
                                <option value="">‚Äî V√°lassz ‚Äî</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="editDocSiteId" class="form-label">Telephely</label>
                            <select class="form-select" id="editDocSiteId" name="siteId" disabled>
                                <option value="">‚Äî El≈ëbb v√°lassz partnert ‚Äî</option>
                            </select>
                        </div>

                        <!-- Metadata edit (egyszer≈±, ugyanaz a row UI) -->
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <label class="form-label mb-0">Egyedi metaadatok</label>
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-secondary"
                                    id="addEditDocMetaRowBtn">
                                    + Sor
                                </button>
                            </div>

                            <div class="border rounded p-2 mt-2">
                                <!-- üî¥ FONTOS: EZ a kont√©ner -->
                                <div id="editDocMetaRows">
                                    <!-- JS t√∂lti fel openEdit-kor -->
                                </div>

                                <small class="text-muted">
                                    Ment√©skor csak a kit√∂lt√∂tt sorok ker√ºlnek elk√ºld√©sre.
                                </small>
                            </div>
                        </div>
                        <div class="col-12 d-none" id="editDocErrorBox">
                            <div class="alert alert-danger mb-0" role="alert" id="editDocErrorText">
                                Hiba t√∂rt√©nt a ment√©s k√∂zben.
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">M√©gse</button>
                <button type="button" class="btn btn-primary" id="saveEditDocumentBtn">Ment√©s</button>
            </div>
        </div>
    </div>
</div>

<!-- Document HISTORY modal -->
<div class="modal fade" id="documentHistoryModal" tabindex="-1" aria-labelledby="documentHistoryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content shadow-lg border-0">
      <div class="modal-header">
        <h5 class="modal-title" id="documentHistoryModalLabel">
          Dokumentum el≈ëzm√©nyek
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bez√°r√°s"></button>
      </div>

      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="text-muted">
            Dokumentum ID: <span class="fw-semibold" id="historyDocIdLabel">‚Äî</span>
          </div>
          <button type="button" class="btn btn-sm btn-outline-secondary" id="refreshDocHistoryBtn">
            <i class="bi bi-arrow-clockwise me-1"></i>Friss√≠t√©s
          </button>
        </div>

        <div id="docHistoryErrorBox" class="alert alert-danger d-none mb-2" role="alert">
          Nem siker√ºlt bet√∂lteni az el≈ëzm√©nyeket.
        </div>

        <div id="docHistoryLoading" class="text-center text-muted py-4 d-none">
          Bet√∂lt√©s...
        </div>

        <div id="docHistoryEmpty" class="text-center text-muted py-4 d-none">
          Nincs el≈ëzm√©ny.
        </div>

        <div class="list-group" id="docHistoryList">
          <!-- JS t√∂lti -->
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Bez√°r√°s</button>
      </div>
    </div>
  </div>
</div>


@{
    var modalVm = ViewData["ModalViewModel"] as Cloud9_2.Models.DocumentModalViewModel;
    var documentTypes = modalVm?.DocumentTypes ?? new List<SelectListItem>();
}

<!-- Document Filter Modal -->
<div class="modal fade" id="docFilterModal" tabindex="-1" aria-labelledby="docFilterModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="docFilterModalLabel">
          <i class="bi bi-funnel me-2"></i>Dokumentum sz≈±r≈ëk
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bez√°r√°s"></button>
      </div>

      <div class="modal-body">
        <form id="docFilterForm" autocomplete="off">
          <div class="row g-3">

            <!-- Search -->
            <div class="col-12">
              <label class="form-label" for="filterSearch">Keres√©s</label>
              <input type="text" class="form-control" id="filterSearch" name="searchTerm"
                     placeholder="F√°jln√©v, felt√∂lt≈ë, partner, t√≠pus...">
              <div class="form-text">Legal√°bb 2 karakter javasolt.</div>
            </div>

            <!-- Status -->
            <div class="col-12 col-md-6">
              <label class="form-label" for="filterStatus">St√°tusz</label>
              <select class="form-select" id="filterStatus" name="statusFilter">
                <option value="all">√ñsszes</option>
                <option value="Be√©rkezett">Be√©rkezett</option>
                <option value="F√ºgg≈ëben">F√ºgg≈ëben</option>
                <option value="Elfogadott">Elfogadott</option>
                <option value="Lez√°rt">Lez√°rt</option>
                <option value="J√≥v√°hagyand√≥">J√≥v√°hagyand√≥</option>
              </select>
            </div>

            <!-- Include inactive -->
            <div class="col-12 col-md-6 d-flex align-items-end">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filterIncludeInactive" name="includeInactive">
                <label class="form-check-label" for="filterIncludeInactive">
                  Inakt√≠v (soft delete) t√©telek is
                </label>
              </div>
            </div>

            <!-- DocumentType (SIMA SELECT) -->
            <div class="col-12 col-md-6">
              <label class="form-label" for="filterDocumentTypeId">Dokumentum t√≠pus</label>
              <select id="filterDocumentTypeId" name="documentTypeId" class="form-select">
                <option value="">‚Äî √ñsszes t√≠pus ‚Äî</option>
                @foreach (var dt in documentTypes)
                {
                    <option value="@dt.Value">@dt.Text</option>
                }
              </select>
            </div>

            <!-- Partner (TomSelect remote) -->
            <div class="col-12 col-md-6">
              <label class="form-label" for="filterPartnerId">Partner</label>
              <select id="filterPartnerId" name="partnerId" class="form-select">
                <option value="">‚Äî √ñsszes partner ‚Äî</option>
              </select>
              <div class="form-text">Partner kiv√°laszt√°sa ut√°n t√∂ltj√ºk a Site list√°t.</div>
            </div>

            <!-- Site (TomSelect options partner alapj√°n) -->
            <div class="col-12 col-md-6">
              <label class="form-label" for="filterSiteId">Site</label>
              <select id="filterSiteId" name="siteId" class="form-select">
                <option value="">‚Äî √ñsszes site ‚Äî</option>
              </select>
            </div>

            <!-- Date range -->
            <div class="col-12 col-md-3">
              <label class="form-label" for="filterDateFrom">L√©trehoz√°s d√°tumt√≥l</label>
              <input type="date" class="form-control" id="filterDateFrom" name="dateFrom">
            </div>

            <div class="col-12 col-md-3">
              <label class="form-label" for="filterDateTo">L√©trehoz√°s d√°tumig</label>
              <input type="date" class="form-control" id="filterDateTo" name="dateTo">
            </div>

            <!-- Sorting -->
            <div class="col-12 col-md-4">
              <label class="form-label" for="filterSortBy">Rendez√©s</label>
              <select class="form-select" id="filterSortBy" name="sortBy">
                <option value="uploaddate">L√©trehoz√°s d√°tuma</option>
                <option value="filename">F√°jln√©v</option>
                <option value="status">St√°tusz</option>
                <option value="documentid">Azonos√≠t√≥</option>
              </select>
            </div>

            <div class="col-12 col-md-2">
              <label class="form-label" for="filterSortDir">Ir√°ny</label>
              <select class="form-select" id="filterSortDir" name="sortDir">
                <option value="desc">Cs√∂kken≈ë</option>
                <option value="asc">N√∂vekv≈ë</option>
              </select>
            </div>

          </div>
        </form>
      </div>

      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary" id="filterResetBtn">
          <i class="bi bi-arrow-counterclockwise me-2"></i>Reset
        </button>

        <div>
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">M√©gse</button>
          <button type="button" class="btn btn-primary" id="filterApplyBtn">
            <i class="bi bi-check2 me-2"></i>Alkalmaz
          </button>
        </div>
      </div>

    </div>
  </div>
</div>
